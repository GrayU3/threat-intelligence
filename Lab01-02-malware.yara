rule Lab01_02_Unpacked_Malware
{
    meta:
        description = "Detects Lab01-02.bin malware after unpacking"
        author = "TheOneWithTheHammer"
        date = "2025-07-23"
        note = "Malware membuat service dan konek ke URL"
    
    strings:
        // String unik
        $url1 = "http://www.malwareanalysisbook.com" ascii
        $svc = "malservice" ascii

        // API functions dari WININET.dll
        $api1 = "InternetOpenUrl" ascii
        $api2 = "InternetOpen" ascii

        // API functions dari ADVAPI32.dll
        $api3 = "CreateService" ascii
        $api4 = "StartServiceCtrlDispatcher" ascii
        $api5 = "OpenSCManager" ascii

    condition:
        uint16(0) == 0x5A4D and
        (
            $url1 or $svc or
            (2 of ($api*))
        )
}
